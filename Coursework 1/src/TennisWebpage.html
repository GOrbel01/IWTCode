<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <script src="jquery-1.11.2.js"></script>
    <script src="getXML.js"></script>
    <title>Tennis Scores WebPage</title>
</head>
<body>
    <script>
        //Fields Required for Buttons
        var setType = 0;
    </script>

    <div id="container" style="float: left">
        <table width="40%" border="double" cellpadding="3" cellspacing="2">
            <tr>
                <th style="text-decoration: underline; text-align: left">Player Search</th>
                <th></th>
            </tr>
            <tr>
                <td><input type="radio" name="DisplayScores" value="MS" onclick="setMensScores()">Men's Scores</td>
                <td><input type="radio" name="DisplayScores" value="WS" onclick="setWomensScores()">Women's Scores</td>
            </tr>
            <tr>
                <td><label>Search Term</label></td>
                <td><input type="text" id="plName" /></td>
            </tr>
            <tr>
                <td><label>Search Type</label></td>
                <td><input type="button" value="Contains" onclick="search(false, plName.value)">
                    <input type="button"  value="Exact Match" onclick="search(true, plName.value)"></td>
            </tr>
        </table>
        <table width="40%" border="double" cellpadding="3" cellspacing="2">
            <tr>
                <th style="text-decoration: underline; text-align: left">Set Quantity Filter</th>
                <td>Number of Sets</td>
            </tr>
            <tr>
                <td><input type="number" value="Sets" id="numSets" min="2" max="5"/></td>
                <td><input type="button" value="Go" onclick="roundSearch(setType, numSets.value)"/></td>
            </tr>
            <tr>
                <td><input type="radio" name="SetFilter" value="lt" onclick="setType=0">Less
                <input type="radio" name="SetFilter" value="eq">Equal
                <input type="radio" name="SetFilter" value="gt">Greater</td>
            </tr>
            <tr>
                <td><input type="button" value="Search" onclick="masterFunction()"/></td>
            </tr>
        </table>
    </div>
        <!--<input type="button" value="Hide Scores" onclick="removeScores()">-->
        <!--<input type="button" value="Test" onclick="search()">-->

        <div id="resultDisplay" style="float: left"></div>
</body>
    <script>

        var xmlDoc;
        var stylesheet = getXML("TennisScores.xsl");
        var nsResolver = stylesheet.createNSResolver(
                stylesheet.ownerDocument == null ?
                        stylesheet.documentElement :
                        stylesheet.ownerDocument.documentElement);
        var value = stylesheet.evaluate(
                "//xsl:template[@match='tournament']//xsl:value-of",
                stylesheet, nsResolver,
                XPathResult.ANY_UNORDERED_NODE_TYPE, null);
        var proc = new XSLTProcessor();
        proc.importStylesheet(stylesheet);

        //String fields to Store Filter Values
        var playerSearchString = "";
        var setSearchString = "";
        var roundSearchString = "";
        var sortString = "";

        /*
            Set Current Document to Wimbledon 2013 Mens
        */
        function setMensScores() {
            xmlDoc = getXML("wimbledon-men-2013.xml");
        }

        /*
         Set Current Document to Wimbledon 2013 Womens
         */
        function setWomensScores() {

            xmlDoc = getXML("wimbledon-women-2013.xml");
        }

        /*
            Main function to handle execution of a search based on the users criteria
        */
        function masterFunction()
        {
            if ((document.getElementById("resultDisplay").hasChildNodes())) { //Handles Before a Search is Entered
                removeResults();
            }
            var funcString = "match [";
            if (playerSearchString.length != 0)
            {
                funcString = funcString + playerSearchString
            }
            if (setSearchString.length != 0)
            {
                funcString = funcString + " and " + setSearchString
            }
            if (roundSearchString.length != 0)
            {
                funcString = funcString + " and " + roundSearchString
            }
            funcString = funcString + "]";
            $(stylesheet).find("xsl\\:apply-templates, apply-templates")
                    .eq(0)
                    .attr("select", funcString);
            if (typeof (XSLTProcessor) != "undefined") {

            }
            else
            {
                window.alert("Your browser sucks...");
            }
            var reResults = proc.transformToFragment(xmlDoc, document);
            document.getElementById("resultDisplay").appendChild(reResults);
        }

        /*
            Sets playerSearchString with the Value input by User
            based on the options chosen
        */
        function playerSearch(isExactSearch, nameVar)
        {
            if (isExactSearch)
            {
                playerSearchString = "player/name='" + nameVar + "'";
            }
            else
            {
                playerSearchString = "player/name[contains(.,'" + nameVar + "')]";
            }
        }

        /*
            Sets setSearchString with the values entered by the user
            based on the options chosen
        */
        function setSearch(setType, num)
        {
            setSearchString = eqXslChange = ".//player[position()=1]/sets-won + .//player[position()=2]/sets-won='" + num + "'";
        }

        /*
            Sets roundSearchString with the values entered by the user
            based on the options chosen
        */
        function roundSearch(roundType, num)
        {
            roundSearchString  = "round='" + num + "'";
        }

        /**
         * Removes the current contents of the div node
         */
        function removeResults()
        {
            var root = document.getElementById("resultDisplay");
            while(root.hasChildNodes())
            {
                root.removeChild(root.firstChild);
            }
        }

    </script>
</html>
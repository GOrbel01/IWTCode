<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <script src="jquery-1.11.2.js"></script>
    <script src="getXML.js"></script>
    <title>Tennis Scores WebPage</title>
</head>
<body>
    <script>
        //Fields Required for Buttons
        var setType = 0;
    </script>

    <div id="container" style="float: left">
        <table style="table-layout: fixed; width: 300px">
            <tr style="border: none; text-align: left">
                <th style="border: none; text-align: left">Select Scores</th>
            </tr>
            <tr>
                <td><input type="button" value="Mens Scores" onclick="setMensScores()"></td>
                <td><input type="button" value="Womens Scores" onclick="setWomensScores()"></td>
            </tr>
            <tr>
                <td></td>
            </tr>
            <tr>
                <td></td>
            </tr>
        </table>
        <table>
            <tr>
                <th>Name Filter</th>
            </tr>
        </table>
        <table>

        </table>
    </div>
        <div id="resultDisplay" style="float: left"></div>
</body>
    <script>

        var xmlDoc;
        var stylesheet = getXML("TennisScores.xsl");
        var nsResolver = stylesheet.createNSResolver(
                stylesheet.ownerDocument == null ?
                        stylesheet.documentElement :
                        stylesheet.ownerDocument.documentElement);
        var value = stylesheet.evaluate(
                "//xsl:template[@match='tournament']//xsl:value-of",
                stylesheet, nsResolver,
                XPathResult.ANY_UNORDERED_NODE_TYPE, null);
        var proc = new XSLTProcessor();
        proc.importStylesheet(stylesheet);

        var hasGeneratedFirstQuery = false;

        //String fields to Store Filter Values
        var playerSearchString = "";
        var setSearchString = "";
        var roundSearchString = "";
        var sortString = "";

        /*
            Set Current Document to Wimbledon 2013 Mens
        */
        function setMensScores() {
            xmlDoc = getXML("wimbledon-men-2013.xml");
        }

        /*
         Set Current Document to Wimbledon 2013 Womens
         */
        function setWomensScores() {

            xmlDoc = getXML("wimbledon-women-2013.xml");
        }

        /*
            Main function to handle execution of a search based on the users criteria
        */
        function runQuery()
        {
            if ((document.getElementById("resultDisplay").hasChildNodes())) { //Handles Before a Search is Entered
                removeResults();
            }
            var funcString = buildQuery();
            $(stylesheet).find("xsl\\:apply-templates, apply-templates")
                    .eq(0)
                    .attr("select", funcString);
            if (typeof (XSLTProcessor) != "undefined") {

            }
            else
            {
                window.alert("Your browser sucks...");
            }
            var reResults = proc.transformToFragment(xmlDoc, document);
            document.getElementById("resultDisplay").appendChild(reResults);
        }

        /*
            Sets playerSearchString with the Value input by User
            based on the options chosen
        */
        function playerSearch(isExactSearch, nameVar)
        {
            if (isExactSearch)
            {
                playerSearchString = "player/name='" + nameVar + "'";
            }
            else
            {
                playerSearchString = "player/name[contains(.,'" + nameVar + "')]";
            }
        }

        /*
            Sets setSearchString with the values entered by the user
            based on the options chosen
        */
        function setSearch(setType, num)
        {
            setSearchString = eqXslChange = ".//player[position()=1]/sets-won + .//player[position()=2]/sets-won='" + num + "'";
        }

        /*
            Sets roundSearchString with the values entered by the user
            based on the options chosen
        */
        function roundSearch(roundType, num)
        {
            roundSearchString  = "round='" + num + "'";
        }

        function buildQuery()
        {
            var funcString = [];
//                    funcString.push("match [");
                if (playerSearchString.length != 0)
                {
                    funcString.push(playerSearchString);
                }
                if (setSearchString.length != 0)
                {
                    funcString.push(setSearchString);
                }
                if (roundSearchString.length != 0)
                {
                    funcString.push(roundSearchString);
                }
//            funcString = funcString + "]";
            var finalString = "match [" + addAnds(funcString) + "]";
            console.log(finalString);
            return finalString;
        }

        function addAnds(arr)
        {
            var finalString = "";
            for (i = 0; i < arr.length; i++)
            {
                if (arr.length == 1)
                {
                    finalString = arr[0];
                }
                else
                {
                    if (i == 0)
                    {
                        finalString += arr[i] + " and ";
                    }
                    else if (i == arr.length-1)
                    {
                        finalString += arr[i];
                    }
                    else
                    {
                        finalString += arr[i] + " and "
                    }
                }
            }
            return finalString;
        }

        /**
         * Removes the current contents of the div node
         */
        function removeResults()
        {
            var root = document.getElementById("resultDisplay");
            while(root.hasChildNodes())
            {
                root.removeChild(root.firstChild);
            }
        }

    </script>
</html>